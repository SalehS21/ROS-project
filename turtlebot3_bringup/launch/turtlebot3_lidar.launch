<launch>
    <!-- Set LiDAR Frame ID -->
    <arg name="set_frame_id" default="base_link"/> <!-- Changed from base_footprint to base_link -->

    <arg name="lds_model" default="$(env LDS_MODEL)" doc="LDS MODEL [LDS-01, LDS-02]"/>

    <!-- Start LDS-01 -->
    <group if="$(eval lds_model == 'LDS-01')">
        <node pkg="hls_lfcd_lds_driver" type="hlds_laser_publisher" name="turtlebot3_lds" output="screen">
            <param name="port" value="/dev/ttyUSB0"/>
            <param name="frame_id" value="$(arg set_frame_id)"/>
        </node>
    </group>

    <!-- Start LDS-02 -->
    <group if="$(eval lds_model == 'LDS-02')">
        <node pkg="ld08_driver" type="ld08_driver" name="turtlebot3_lds" output="screen" args="LD08">
            <param name="frame_id" value="$(arg set_frame_id)"/>
        </node>
    </group>

    <!-- Publish static transform between base_link and laser_frame -->
    <node pkg="tf" type="static_transform_publisher" name="laser_tf"
          args="0 0 0.1 0 0 0 base_link laser_frame 100" />

    <!-- Start Hector SLAM -->
    <node pkg="hector_mapping" type="hector_mapping" name="hector_mapping" output="screen">
        <param name="base_frame" value="base_link"/>
        <param name="odom_frame" value="map"/>  <!-- No odometry, so odom_frame = map -->
        <param name="map_frame" value="map"/>
        <param name="scan_frame" value="laser_frame"/>
        <param name="scan_topic" value="/scan"/> <!-- Ensure this matches your LiDAR topic -->
        <param name="pub_map_odom_transform" value="true"/>
        <param name="pub_map_scanmatch_transform" value="true"/>
        <param name="use_tf_scan_transformation" value="true"/>
        <param name="use_tf_pose_start_estimate" value="false"/>
        <param name="map_update_distance_thresh" value="0.2"/>
        <param name="map_update_angle_thresh" value="0.1"/>
    </node>
</launch>
